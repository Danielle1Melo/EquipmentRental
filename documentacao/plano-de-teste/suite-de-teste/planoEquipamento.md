# Plano de Teste para Model (Sprint V)

| Funcionalidade                    | Comportamento Esperado                                                                                                                                  | Verificações                                                                                                  | Critérios de Aceite                                                                                             |
|----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
| Cadastro válido de equipamento   | Um equipamento com todos os campos obrigatórios e válidos deve ser salvo com sucesso                                                                   | Inserir um equipamento com todos os campos obrigatórios preenchidos corretamente                             | O equipamento é salvo e retornado com _id, equiStatus como false, equiNotaMediaAvaliacao como 0, e equiAvaliacoes como [] |
| Campos obrigatórios              | Não deve ser possível cadastrar um equipamento sem nome, descrição, valor da diária, categoria, fotos ou quantidade disponível                        | Tentar salvar equipamento com cada um desses campos ausentes                                                  | A operação deve falhar com erro de validação (`ValidationError`)                                                |
| Valor padrão para equiStatus     | Ao cadastrar um equipamento o valor padrão deve ser `false`                                                                   | Cadastrar equipamento sem informar o campo equiStatus                                                         | O campo equiStatus deve ser `false` no documento salvo                                                           |
| Valor padrão para equiNotaMediaAvaliacao | Ao cadastrar um equipamento, a nota média de avaliação deve ser 0 por padrão                                                                 | Cadastrar equipamento e verificar valor de equiNotaMediaAvaliacao                                             | O campo equiNotaMediaAvaliacao deve ser `0`                                                                      |
| Valor padrão para equiAvaliacoes | O array de avaliações deve ser iniciado como vazio ao criar o equipamento                                                                             | Cadastrar equipamento e verificar valor de equiAvaliacoes                                                     | O campo equiAvaliacoes deve ser um array vazio `[]`                                                              |
| Leitura de equipamentos          | O sistema deve retornar todos os equipamentos cadastrados                                                                                              | Criar dois equipamentos e fazer uma leitura com `find()`                                                      | A resposta contém um array com os equipamentos cadastrados e os nomes corretos                                  |

# Plano de Teste para Controller (Sprint V)

| Funcionalidade | Comportamento Esperado | Verificações | Critérios de Aceite |
|----------------|-----------------------|--------------|---------------------|
| Listagem de equipamentos | Deve listar equipamentos com query válida | Enviar requisição com query de filtro (ex.: `categoria=câmera`) | A resposta contém um array com os equipamentos filtrados corretamente |
| Listagem sem query | Deve listar todos os equipamentos quando nenhuma query é fornecida | Enviar requisição sem parâmetros de query | A resposta contém um array com todos os equipamentos cadastrados |
| Busca por ID | Deve retornar um equipamento específico pelo ID | Enviar requisição com um ID válido | A resposta contém os dados do equipamento correspondente ao ID |
| Cadastro de equipamento | Deve criar um equipamento com dados válidos | Enviar requisição com dados válidos conforme o schema (`equiNome`, `equiValorDiaria`, etc.) | O equipamento é criado e retorna mensagem de sucesso com status "Aguardando aprovação" |
| Validação de schema no cadastro | Deve retornar erro 400 para dados inválidos no cadastro | Enviar requisição com dados ausentes ou inválidos | Retorna erro 400 com mensagem de dados inválidos |
| Atualização de equipamento | Deve atualizar um equipamento com dados válidos | Enviar requisição com ID válido e dados válidos conforme o schema de atualização | O equipamento é atualizado e retorna mensagem de sucesso com os dados atualizados |
| Validação de ID na atualização | Deve retornar erro para ID inválido na atualização | Enviar requisição com ID inválido | Retorna erro de validação (`ZodError`) |
| Validação de dados na atualização | Deve retornar erro para dados inválidos na atualização | Enviar requisição com dados inválidos conforme o schema de atualização | Retorna erro de validação (`ZodError`) |
| Equipamento inexistente na atualização | Deve retornar erro 404 ao tentar atualizar equipamento inexistente | Enviar requisição com ID de equipamento não cadastrado | Retorna erro 404 com mensagem "Equipamento não encontrado" |
| Falha inesperada na atualização | Deve retornar erro 500 para falhas inesperadas na atualização | Simular erro interno no serviço de atualização | Retorna erro 500 com mensagem de erro interno |

# Plano de Testes para Service (Sprint V)

| Funcionalidade                  | Comportamento Esperado                                                                                  | Verificações                                                                                     | Critérios de Aceite                                                                                              |
|--------------------------------|--------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|
| Listagem de Equipamentos        | Deve processar filtros recebidos e retornar lista de equipamentos filtrados corretamente               | Chamar listar() com filtros variados; verificar se os filtros são processados corretamente e se o repositório é chamado com query, página e limite | Retorna lista filtrada conforme os parâmetros; filtros aplicados corretamente                                  |
| Busca por ID                   | Deve retornar o equipamento se existir e se o usuário tiver permissão para visualizá-lo                | Buscar equipamento por ID; testar retorno do equipamento quando ativo; lançar erro 403 se usuário não é dono e equipamento inativo; lançar erro 404 se não encontrado | Equipamento retornado se usuário autorizado; erros 403 e 404 lançados apropriadamente                           |
| Cadastro de Equipamento         | Deve validar campos obrigatórios e fotos, criar equipamento com valores padrão e associar usuário       | Criar equipamento com dados completos e corretos; lançar erro se faltar nome, categoria ou fotos | Equipamento criado com dados corretos e valores padrão definidos; erros lançados para dados obrigatórios faltantes |
| Validação de Campos no Cadastro | Deve garantir que campos obrigatórios não estejam ausentes e fotos sejam array não vazio                | Tentar criar com dados incompletos e fotos inválidas                                          | Erro 400 lançado para ausência de campos obrigatórios ou fotos inválidas                                       |
| Atualização de Equipamento      | Deve permitir atualizar apenas campos permitidos, e permitir ativar equipamento inativo                | Atualizar equipamento ativo com campos permitidos; permitir ativar equipamento inativo; bloquear atualizações indevidas ou campos não permitidos | Atualização realizada com sucesso quando válida; erros lançados ao tentar atualizar campos proibidos ou equipamento inativo sem ativar status |
| Atualização de Equipamento Inativo | Permitir apenas atualização do status para ativo                                                 | Atualizar apenas o campo status para true em equipamento inativo                              | Atualização permitida apenas para ativação do equipamento; erros para outras alterações                         |
| Atualização com Campos Inválidos | Deve bloquear atualização se campos não permitidos forem alterados                               | Tentar atualizar campos fora da lista permitida                                              | Erro 400 com mensagem clara sobre campos proibidos                                                             |
| Atualização de Equipamento Inexistente | Deve lançar erro 404 se o equipamento não existir                                            | Tentar atualizar com ID inexistente                                                          | Erro 404 lançado com mensagem de equipamento não encontrado                                                    |
| Remoção de Equipamento          | Deve permitir remoção apenas se não houver locações ativas                                            | Deletar equipamento sem locações ativas; lançar erro se locações ativas                       | Equipamento removido com sucesso; erro 409 lançado se houver locações ativas                                    |
| Remoção de Equipamento Inexistente | Deve lançar erro 404 ao tentar deletar equipamento inexistente                                   | Tentar deletar equipamento com ID inválido ou inexistente                                    | Erro 404 lançado com mensagem clara                                                                             |

# Plano de Testes para Repository (Sprint V)

| Funcionalidade | Comportamento Esperado | Verificações | Critérios de Aceite |
|----------------|-----------------------|--------------|---------------------|
| Inicialização do repositório | Usa `EquipamentoModel` como padrão se nenhum modelo for fornecido | Instanciar `EquipamentoRepository` sem modelo e verificar o atributo `model` | Repositório usa `EquipamentoModel` como modelo padrão |
| Cadastro de equipamento | Cria e salva equipamento com status inativo | Passar dados válidos (`nome`, `descricao`, `categoria`, `valorDiaria`, `disponibilidade`) e verificar se `save` é chamado | Equipamento é salvo com `ativo=false` e retorna com `_id` |
| Cadastro com atributos obrigatórios ausentes | Lança erro se faltarem campos obrigatórios | Passar dados incompletos (ex.: só `nome`) e verificar se `save` rejeita | Lança erro "Missing required fields"; equipamento não é salvo |
| Listagem de equipamentos | Lista equipamentos com filtros de categoria, preço e disponibilidade | Passar query com `categoria`, `valorDiariaMin`, `valorDiariaMax`, `disponibilidade`, `page` e `limit`, e verificar chamada de `paginate` | Retorna equipamentos filtrados; `paginate` usa query, `page`, `limit` e `sort: { equiNome: 1 }` |
| Listagem de equipamentos ativos | Lista apenas equipamentos com `ativo=true` | Passar query com `ativo=true`, `page` e `limit`, e verificar chamada de `paginate` | Retorna equipamentos ativos; `paginate` inclui `ativo=true` |
| Busca por ID | Retorna equipamento ativo pelo ID | Passar ID válido e verificar se `findById` retorna equipamento | Retorna equipamento; `findById` é chamado com ID |
| Busca por ID inexistente | Retorna null se equipamento não existe | Passar ID inexistente e verificar se `findById` retorna null | Retorna null; `findById` é chamado com ID |
| Atualização de equipamento | Atualiza equipamento e marca como inativo | Passar ID válido e dados (`nome`, `valorDiaria`) e verificar se `findByIdAndUpdate` atualiza | Equipamento é atualizado com `ativo=false`; retorna equipamento atualizado; usa `{ new: true }` |
| Atualização de equipamento inexistente | Retorna null se equipamento não existe | Passar ID inexistente e dados, e verificar se `findByIdAndUpdate` retorna null | Retorna null; `findByIdAndUpdate` é chamado com ID |
| Remoção de equipamento | Inativa equipamento sem locações ativas | Passar ID válido e verificar se `findByIdAndDelete` é chamado | Equipamento é removido; retorna equipamento removido; `findByIdAndDelete` é chamado |
| Remoção de equipamento inexistente | Retorna null se equipamento não existe | Passar ID inexistente e verificar se `findByIdAndDelete` retorna null | Retorna null; `findByIdAndDelete` é chamado com ID |

# Plano de Testes para FilterBuilder (Sprint V)

| Funcionalidade | Comportamento Esperado | Verificações | Critérios de Aceite |
|----------------|-----------------------|--------------|---------------------|
| Inicialização do builder | Inicia com filtros vazios | Criar instância de `EquipamentoFilterBuilder` e verificar o estado inicial do atributo `filtros` | O atributo `filtros` é um objeto vazio (`{}`) |
| Filtro por categoria | Adiciona filtro de categoria quando valor válido é fornecido | Passar uma categoria válida (ex.: "Furadeira") ao método `comCategoria` e verificar se `equiCategoria` é adicionado aos filtros | Filtro `equiCategoria` é definido com o valor fornecido; método retorna o próprio builder |
| Filtro por categoria inválida | Não adiciona filtro se categoria é undefined, null ou string vazia | Passar `undefined`, `null` ou `""` ao método `comCategoria` e verificar se `equiCategoria` permanece ausente | Filtro `equiCategoria` não é definido; método retorna o próprio builder |
| Filtro por status | Adiciona filtro de status quando valor booleano é fornecido | Passar `true` ou `false` ao método `comStatus` e verificar se `equiStatus` é adicionado aos filtros | Filtro `equiStatus` é definido com o valor booleano; método retorna o próprio builder |
| Filtro por status inválido | Não adiciona filtro se status não é booleano, é undefined ou null | Passar `"true"`, `undefined` ou `null` ao método `comStatus` e verificar se `equiStatus` permanece ausente | Filtro `equiStatus` não é definido; método retorna o próprio builder |
| Filtro por faixa de valor (apenas mínimo) | Adiciona filtro com valor mínimo quando apenas `minValor` é fornecido | Passar um valor numérico para `minValor` e `undefined` para `maxValor` no método `comFaixaDeValor` e verificar o filtro `equiValorDiaria` | Filtro `equiValorDiaria` é `{ $gte: minValor }`; método retorna o próprio builder |
| Filtro por faixa de valor (apenas máximo) | Adiciona filtro com valor máximo quando apenas `maxValor` é fornecido | Passar `undefined` para `minValor` e um valor numérico para `maxValor` no método `comFaixaDeValor` e verificar o filtro `equiValorDiaria` | Filtro `equiValorDiaria` é `{ $lte: maxValor }`; método retorna o próprio builder |
| Filtro por faixa de valor (mínimo e máximo) | Adiciona filtro com faixa de valor quando ambos `minValor` e `maxValor` são fornecidos | Passar valores numéricos para `minValor` e `maxValor` no método `comFaixaDeValor` e verificar o filtro `equiValorDiaria` | Filtro `equiValorDiaria` é `{ $gte: minValor, $lte: maxValor }`; método retorna o próprio builder |
| Filtro por faixa de valor inválido | Não adiciona filtro se ambos `minValor` e `maxValor` são undefined | Passar `undefined` para ambos `minValor` e `maxValor` no método `comFaixaDeValor` e verificar se `equiValorDiaria` permanece ausente | Filtro `equiValorDiaria` não é definido; método retorna o próprio builder |
| Conversão de strings numéricas em faixa de valor | Converte strings numéricas para números em `minValor` e `maxValor` | Passar strings numéricas (ex.: "50", "100") ou com espaços (ex.: " 50 ") ao método `comFaixaDeValor` e verificar o filtro `equiValorDiaria` | Filtro `equiValorDiaria` usa valores numéricos convertidos (ex.: `{ $gte: 50, $lte: 100 }`); método retorna o próprio builder |
| Construção de filtros | Retorna objeto de filtros vazio se nenhum filtro foi adicionado | Chamar `build` sem adicionar filtros e verificar o resultado | Retorna `{}` |
| Construção de filtro de categoria | Retorna objeto com filtro de categoria quando adicionado | Adicionar filtro com `comCategoria` e chamar `build` para verificar o resultado | Retorna `{ equiCategoria: valor }` |
| Construção de filtro de status | Retorna objeto com filtro de status quando adicionado | Adicionar filtro com `comStatus` e chamar `build` para verificar o resultado | Retorna `{ equiStatus: valor }` |
| Construção de filtro de faixa de valor | Retorna objeto com filtro de faixa de valor quando adicionado | Adicionar filtro com `comFaixaDeValor` e chamar `build` para verificar o resultado | Retorna `{ equiValorDiaria: { $gte: minValor, $lte: maxValor } }` |
| Construção de múltiplos filtros | Retorna objeto com todos os filtros adicionados | Adicionar filtros com `comCategoria`, `comStatus` e `comFaixaDeValor` e chamar `build` para verificar o resultado | Retorna objeto com todos os filtros (ex.: `{ equiCategoria: "Furadeira", equiStatus: true, equiValorDiaria: { $gte: 50, $lte: 100 } }`) |
| Encadeamento de métodos | Permite encadear métodos e construir filtros corretamente | Encadear chamadas a `comCategoria`, `comStatus`, `comFaixaDeValor` e `build`, verificando o resultado final | Retorna objeto com todos os filtros encadeados corretamente |